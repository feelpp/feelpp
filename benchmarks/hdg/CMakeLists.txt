###  CMakeLists.txt; coding: utf-8 ---

#  Author(s): Christophe Prud'homme <christophe.prudhomme@feelpp.org>
#       Date: 03 Mar 2016
#
#  Copyright (C) 2016 Feel++ Consortium
#
# Distributed under the GPL(GNU Public License):
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software
# Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
#
#

include_directories(${CMAKE_CURRENT_SOURCE_DIR})
include_directories(${CMAKE_SOURCE_DIR}/toolboxes ${CMAKE_BINARY_DIR}/toolboxes)

###################################################

# Laplacian
foreach( dim 2 3)
  foreach( orderP 0 1 2 3 4)
    set(modulename "hdg_laplacian")
    set(BENCH "${modulename}_${dim}D_P${orderP}" )
    set(targetname ${BENCH})
    FILE(WRITE ${CMAKE_CURRENT_BINARY_DIR}/${BENCH}.cpp
      "// this file is auto-generated by Feel++ \n\n
    #define BOOST_TEST_MODULE hdg_laplacian
    #include <testsuite/testsuite.hpp>
    #include<hdg_laplacian.hpp>\n\n
    using namespace Feel;

    FEELPP_ENVIRONMENT_WITH_OPTIONS( makeAbout(), makeOptions() );

    BOOST_AUTO_TEST_SUITE( hdg_laplacian )

    BOOST_AUTO_TEST_CASE( hdg_laplacian_${dim}D_P${order} )
    //int main( int argc, char** argv )
    {
      //Feel::Assert::setLog( \"${BENCH}.assert\");
      //Feel::Environment env( argc, argv, makeOptions() );
      Hdg<${dim}, ${orderP}> hdg;
      hdg.convergence();
    }
    BOOST_AUTO_TEST_SUITE_END()
    \n" )

    feelpp_add_application(${targetname} SRCS ${BENCH}.cpp DEFS FEELPP_${dim}D )
  endforeach() # order
endforeach() # dim

# Laplacian-IBC
foreach( dim 2 3)
  foreach( orderP 0 1 2 3 4)
      set(file "hdg_laplacian_ibc")
      set(modulename "${file}")
      set(BENCH "${modulename}_${dim}D_P${orderP}" )
      set(targetname ${BENCH})
      FILE(WRITE ${CMAKE_CURRENT_BINARY_DIR}/${BENCH}.cpp
        "// this file is auto-generated by Feel++ \n\n
        #define BOOST_TEST_MODULE ${modulename}
        #include <testsuite/testsuite.hpp>
        #include<${file}.hpp>\n\n
        using namespace Feel;

        FEELPP_ENVIRONMENT_WITH_OPTIONS( makeAbout(), makeOptions() );

        BOOST_AUTO_TEST_SUITE( ${modulename} )

        BOOST_AUTO_TEST_CASE( ${BENCH} )
        //int main( int argc, char** argv )
        {
          //Feel::Assert::setLog( \"${BENCH}.assert\");
          //Feel::Environment env( argc, argv, makeOptions() );
          Hdg<${dim}, ${orderP}> hdg;
          hdg.convergence();
        }
        BOOST_AUTO_TEST_SUITE_END()
        \n" )

      feelpp_add_application(${targetname} SRCS ${BENCH}.cpp DEFS FEELPP_${dim}D USE_FACE_MESH )
  endforeach() # order
endforeach() # dim

###################################################

# Linear elasticity
#foreach( geom 1 2 )
foreach( dim 2 3)
  foreach( orderP 0 1 2 3 4)
    set(modulename "hdg_linear_elasticity")
    set(BENCH "${modulename}_${dim}D_P${orderP}" )
    set(targetname ${BENCH})
    FILE(WRITE ${CMAKE_CURRENT_BINARY_DIR}/${BENCH}.cpp
      "// this file is auto-generated by Feel++ \n\n
    #define BOOST_TEST_MODULE hdg_linear_elasticity
    #include <testsuite/testsuite.hpp>
    #include<hdg_linear_elasticity.hpp>\n\n
    using namespace Feel;

    FEELPP_ENVIRONMENT_WITH_OPTIONS( makeAbout(), makeOptions() );

    BOOST_AUTO_TEST_SUITE( hdg_linear_elasticity )

    BOOST_AUTO_TEST_CASE( hdg_linear_elasticity_${dim}D_P${order} )
    //int main( int argc, char** argv )
    {
      //Feel::Assert::setLog( \"${BENCH}.assert\");
      //Feel::Environment env( argc, argv, makeOptions() );
      Hdg<${dim}, ${orderP}> hdg;
      hdg.run();
    }
    BOOST_AUTO_TEST_SUITE_END()
    \n" )

    feelpp_add_application(${targetname} SRCS ${BENCH}.cpp DEFS FEELPP_${dim}D )
  endforeach() # order
endforeach() # dim
# endforeach() # geom

# Linear elasticity - IBC
#foreach( geom 1 2 )
foreach( dim 2 3)# 3
  foreach( orderP 0 1 2 3 4)
    set(modulename "hdg_linear_elasticity_ibc")
    set(BENCH "${modulename}_${dim}D_P${orderP}" )
    set(targetname ${BENCH})
    FILE(WRITE ${CMAKE_CURRENT_BINARY_DIR}/${BENCH}.cpp
      "// this file is auto-generated by Feel++ \n\n
    #define BOOST_TEST_MODULE hdg_linear_elasticity
    #include <testsuite/testsuite.hpp>
    #include<hdg_linear_elasticity_ibc.hpp>\n\n
    using namespace Feel;

    FEELPP_ENVIRONMENT_WITH_OPTIONS( makeAbout(), makeOptions() );

    BOOST_AUTO_TEST_SUITE( hdg_linear_elasticity_ibc )

    BOOST_AUTO_TEST_CASE( hdg_linear_elasticity_ibc_${dim}D_P${order} )
    //int main( int argc, char** argv )
    {
      //Feel::Assert::setLog( \"${BENCH}.assert\");
      //Feel::Environment env( argc, argv, makeOptions() );
      Hdg<${dim}, ${orderP}> hdg;
      hdg.run();
    }
    BOOST_AUTO_TEST_SUITE_END()
    \n" )

    feelpp_add_application(${targetname} SRCS ${BENCH}.cpp DEFS FEELPP_${dim}D )
  endforeach() # order
endforeach() # dim
# endforeach() # geom


###################################################

foreach(D RANGE 2 3 1)
  foreach(P RANGE 0 4 1) #3
    foreach(N RANGE 1 2 1)
      foreach(E RANGE 2 4 1)
        feelpp_add_application( cvg_mixedpoisson_${D}DP${P}G${N}E${E}
                                SRCS cvg_mixedpoisson_main.cpp cvg_mixedpoisson.hpp
                                DEFS FEELPP_DIM=${D} FEELPP_ORDER=${P} FEELPP_GEO_ORDER=${N} FEELPP_EXP_ORDER=${E} USE_SAME_MAT=1
                                # INCLUDE_IN_ALL
                                LINK_LIBRARIES feelpp_modelcore )
      endforeach()
    endforeach() 
  endforeach()
endforeach()


###################################################

foreach(D RANGE 2 3 1)
  foreach(P RANGE 0 4 1) #3
    foreach(N RANGE 1 2 1)
      foreach(E 4 )
        feelpp_add_application( cvg_mixedelasticity_${D}DP${P}G${N}E${E}
                                SRCS cvg_mixedelasticity_main.cpp cvg_mixedelasticity.hpp
                                DEFS FEELPP_DIM=${D} FEELPP_ORDER=${P} FEELPP_GEO_ORDER=${N} FEELPP_EXP_ORDER=${E}
                                # INCLUDE_IN_ALL
                                LINK_LIBRARIES feelpp_modelcore )
      endforeach()
    endforeach() 
  endforeach()
endforeach()

feelpp_add_testcase(cvg-mp-tests)
feelpp_add_testcase(cvg-el-tests)
feelpp_add_testcase(hdg_mp_ibc)
feelpp_add_testcase(hdg_me)
